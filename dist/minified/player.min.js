class RadioPlayer{constructor(){this.radioPlayer=document.getElementById("radioPlayer"),this.artistInfo=document.getElementById("artistInfo"),this.titleInfo=document.getElementById("titleInfo"),this.albumArtwork=document.getElementById("albumArtwork"),this.djInfoElement=document.getElementById("djInfo"),this.artworkElement=document.getElementById("artwork"),this.playPauseButton=document.getElementById("playPauseButton"),this.volumeSlider=document.getElementById("volumeSlider"),this.castButton=document.getElementById("castButton"),this.playlistButton=document.getElementById("playlistButton"),this.isPlaying=!1,this.userPaused=!1,this.defaultImage="https://res.cloudinary.com/xerosradio/image/upload/w_500,h_500,f_webp,q_auto/XerosRadio_Logo_Achtergrond_Wit",this.streamUrl="https://stream.streamxerosradio.duckdns.org/xerosradio",this.playPauseButton?.setAttribute("aria-label","Play / Pauze"),this.volumeSlider?.setAttribute("aria-label","Volume aanpassen"),this.castButton?.setAttribute("aria-label","Cast naar apparaat"),this.playlistButton?.setAttribute("aria-label","Check de nummers die net zijn gedraaid"),this.lastSong={artist:"",title:"",cover:""},this.lastDJ={status:null,name:"",cover:""},this.playPauseButton&&this.playPauseButton.addEventListener("click",this.togglePlay),this.volumeSlider&&this.volumeSlider.addEventListener("input",this.adjustVolume),this.castButton&&this.castButton.addEventListener("click",this.castButtonClick),this.playlistButton&&this.playlistButton.addEventListener("click",this.openPlaylistPage);const a=this.getVolumeFromCookie()??.5;this.volumeSlider&&(this.volumeSlider.value=a),this.radioPlayer&&(this.radioPlayer.volume=a),this._isUpdatingRadioInfo=!1,this.updateRadioInfo(),this._radioInfoInterval=setInterval(()=>this.updateRadioInfo(),5e3),this.initializeCastSDK(),this.setupMediaSession(),this.radioPlayer?.addEventListener("error",this.handleStreamError),this.radioPlayer?.addEventListener("stalled",this.handleStreamError),this.radioPlayer?.addEventListener("ended",this.handleStreamError),this.radioPlayer?.addEventListener("pause",this.handlePause),this.reconnectDelay=3e3,this.isIOS=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,this.isIOS&&(document.querySelectorAll(".hide-on-ios").forEach(a=>{a.style.display="none"}),this.castButton&&(this.castButton.disabled=!0,this.castButton.style.pointerEvents="none",this.castButton.title="Casting niet beschikbaar op iOS"))}createArtworkImage=(a,b="XerosRadio",c=200,d=200)=>{const e=new Image;return e.src=a,e.alt=b,e.draggable=!1,e.loading="lazy",e.style.width=`${c}px`,e.style.height=`${d}px`,e.onerror=()=>{e.src=this.defaultImage},e};isValidUrl=a=>{try{return new URL(a),!0}catch{return!1}};updateRadioInfo=async()=>{if(!this._isUpdatingRadioInfo){this._isUpdatingRadioInfo=!0;try{const a=await fetch("https://xr-api-prd.faststreamdiensten.nl/",{method:"GET",cache:"no-cache"});if(!a.ok)throw new Error("Fout bij ophalen data");const b=await a.json(),{artist:c,title:d,cover_art200x200:e}=b.current_song,{dj_live_status:f,dj_name:g,dj_cover:h}=b.onair_info,i=e||this.defaultImage;if((c!==this.lastSong.artist||d!==this.lastSong.title||i!==this.lastSong.cover)&&(this.artistInfo&&(this.artistInfo.textContent=c),this.titleInfo&&(this.titleInfo.textContent=d),this.albumArtwork&&(this.albumArtwork.src=i),this.updateMediaMetadata(),this.lastSong={artist:c,title:d,cover:i}),f!==this.lastDJ.status||g!==this.lastDJ.name||h!==this.lastDJ.cover){this.djInfoElement&&(this.djInfoElement.textContent=g);const a=this.isValidUrl(h)?h:this.defaultImage;this.artworkElement&&(this.artworkElement.innerHTML="",this.artworkElement.appendChild(this.createArtworkImage(a,"XerosRadio DJ"))),this.lastDJ={status:f,name:g,cover:h}}}catch(a){this.handleError(a)}finally{this._isUpdatingRadioInfo=!1}}};handleError=a=>{console.error("Fout:",a),this.djInfoElement&&(this.djInfoElement.textContent="XerosRadio is momenteel niet beschikbaar."),this.artworkElement&&(this.artworkElement.innerHTML="",this.artworkElement.appendChild(this.createArtworkImage(this.defaultImage)))};initializeCastSDK=()=>{this.isIOS||(window.__onGCastApiAvailable=a=>{if(a){const a=cast.framework.CastContext.getInstance();a.setOptions({receiverApplicationId:chrome.cast.media.DEFAULT_MEDIA_RECEIVER_APP_ID,autoJoinPolicy:chrome.cast.AutoJoinPolicy.ORIGIN_SCOPED}),a.addEventListener(cast.framework.CastContextEventType.SESSION_STATE_CHANGED,this.handleCastSessionState)}})};setupMediaSession=()=>{"mediaSession"in navigator&&(navigator.mediaSession.setActionHandler("play",this.playMedia),navigator.mediaSession.setActionHandler("pause",this.pauseMedia),navigator.mediaSession.setActionHandler("stop",this.pauseMedia))};updateMediaMetadata=()=>{if("mediaSession"in navigator){const a=this.artistInfo?.textContent||"XerosRadio",b=this.titleInfo?.textContent||"Bij XerosRadio zit je goed",c=this.albumArtwork?.src||this.defaultImage;navigator.mediaSession.metadata=new MediaMetadata({title:b,artist:a,artwork:[{src:c,sizes:"500x500",type:"image/webp"}]})}};handleCastSessionState=a=>{a.sessionState===cast.framework.SessionState.SESSION_STARTED?(this.pauseMedia(),setTimeout(this.loadMediaToCast,1e3)):a.sessionState===cast.framework.SessionState.SESSION_ENDED&&this.playMedia()};castButtonClick=()=>{if(!this.isIOS){const a=cast.framework.CastContext.getInstance();a.requestSession().then(this.loadMediaToCast).catch(a=>console.error("Cast fout:",a))}};loadMediaToCast=()=>{if(!this.isIOS){const a=cast.framework.CastContext.getInstance().getCurrentSession();if(a){const b=new chrome.cast.media.MediaInfo(this.streamUrl,"audio/aac");b.metadata=new chrome.cast.media.MusicTrackMediaMetadata,b.metadata.title="Bij XerosRadio zit je goed. Altijd online de beste Nederlandstalige geheime zender en piraten hits. 24 uur per dag de mooiste muziek.",b.metadata.artist="XerosRadio",b.metadata.images=[{url:this.defaultImage}];const c=new chrome.cast.media.LoadRequest(b);a.loadMedia(c).then(()=>console.log("Cast gestart")).catch(a=>console.error("Fout bij casten:",a))}}};togglePlay=()=>{this.isPlaying?(this.userPaused=!0,this.pauseMedia()):(this.userPaused=!1,this.playMedia())};playMedia=()=>{if(this.radioPlayer){this.radioPlayer.src=this.streamUrl;try{const a=this.radioPlayer.play();a&&"function"==typeof a.then?a.then(()=>{this.isPlaying=!0,this.updatePlayPauseButton()}).catch(a=>{console.error("Fout bij afspelen:",a),setTimeout(this.playMedia,this.reconnectDelay)}):(this.isPlaying=!0,this.updatePlayPauseButton())}catch(a){console.error("Fout bij afspelen:",a),setTimeout(this.playMedia,this.reconnectDelay)}}};pauseMedia=()=>{this.radioPlayer&&(this._programmaticPause=!0,this.radioPlayer.pause(),this.isPlaying=!1,this.updatePlayPauseButton(),setTimeout(()=>{this._programmaticPause=!1},100))};updatePlayPauseButton=()=>{this.playPauseButton&&(this.playPauseButton.className=this.isPlaying?"fas fa-pause":"fas fa-play")};adjustVolume=()=>{this.radioPlayer&&this.volumeSlider&&(this.radioPlayer.volume=this.volumeSlider.value,this.saveVolumeToStorage(this.volumeSlider.value))};saveVolumeToStorage=a=>{try{localStorage.setItem("xr_volume",a)}catch{}};getVolumeFromCookie=()=>{try{const a=localStorage.getItem("xr_volume");if(null!==a)return parseFloat(a)}catch{}const a=document.cookie.split(";").find(a=>a.trim().startsWith("volume="));if(!a)return null;const b=a.split("=")[1],c=parseFloat(b);return isNaN(c)?null:c};handleStreamError=()=>{this.userPaused||(console.warn("Stream onderbroken. Herstart..."),setTimeout(this.playMedia,this.reconnectDelay))};handlePause=()=>{this.userPaused||this._programmaticPause||!this.radioPlayer||this.radioPlayer.ended||(console.warn("Pauze zonder gebruikersinput. Herstart..."),setTimeout(this.playMedia,this.reconnectDelay))};openPlaylistPage=()=>{window.location.href="https://xerosradio.pages.dev/playlist"};destroy=()=>{clearInterval(this._radioInfoInterval),this.playPauseButton?.removeEventListener("click",this.togglePlay),this.volumeSlider?.removeEventListener("input",this.adjustVolume),this.castButton?.removeEventListener("click",this.castButtonClick),this.playlistButton?.removeEventListener("click",this.openPlaylistPage),this.radioPlayer?.removeEventListener("error",this.handleStreamError),this.radioPlayer?.removeEventListener("stalled",this.handleStreamError),this.radioPlayer?.removeEventListener("ended",this.handleStreamError),this.radioPlayer?.removeEventListener("pause",this.handlePause)}}const radioPlayer=new RadioPlayer;