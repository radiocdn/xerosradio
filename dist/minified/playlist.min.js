document.addEventListener("DOMContentLoaded",()=>{function a(a,b="",c=""){const d=document.createElement(a);return b&&(d.className=b),c&&(d.textContent=c),d}function b(a){if(!a)return"";if(/^\d{2}:\d{2}$/.test(a))return a;const b=new Date(a);return isNaN(b)?a:b.toLocaleString("nl-NL",{hour:"2-digit",minute:"2-digit"})}function c(c){const d=c.artist||"Onbekend",e=c.title||"Onbekend nummer",f=b(c.played_at),g=c.cover_art200x200&&c.cover_art200x200.startsWith("http")?c.cover_art200x200:i,h=a("div","playlist-item"),j=a("img","song-cover-playlist");j.src=g,j.alt=`${d} - ${e}`,j.loading="lazy",j.decoding="async",j.draggable=!1,j.onerror=()=>{j.src=i};const k=a("div","details"),l=a("h2","",d),m=a("p","",e);if(c.dj&&""!==c.dj.trim()){const b=a("p","dj-name");if(b.textContent=`Gedraaid door ${c.dj} `,c.dj_cover&&c.dj_cover.startsWith("http")){const a=document.createElement("img");a.src=c.dj_cover,a.alt=`${c.dj}`,a.className="dj-cover",a.loading="lazy",a.decoding="async",a.onerror=()=>{a.style.display="none"},b.appendChild(a)}k.appendChild(b)}const n=a("p","",f);k.append(l,m,n);const o=a("div","spotify-youtube-container"),p=encodeURIComponent(`${d} - ${e}`);return[{href:`https://open.spotify.com/search/${p}`,icon:"fab fa-spotify spotify-icon",label:"Zoek op Spotify"},{href:`https://www.youtube.com/results?search_query=${p}`,icon:"fab fa-youtube youtube-icon",label:"Zoek op YouTube"},{href:`https://soundcloud.com/search?q=${p}`,icon:"fab fa-soundcloud soundcloud-icon",label:"Zoek op SoundCloud"}].forEach(({href:b,icon:c,label:d})=>{const e=document.createElement("a");e.href=b,e.target="_blank",e.rel="noopener",e.setAttribute("aria-label",d),e.innerHTML=`<i class="${c}"></i>`,o.appendChild(e)}),h.append(j,k,o),h}async function d(a,b={},c=2,d=500){for(let e=0;e<=c;e++)try{const c=await fetch(a,b);if(!c.ok)throw new Error("Kan de afspeellijst niet laden.");return await c.json()}catch(a){if(e===c)throw a;await new Promise(a=>setTimeout(a,d))}}function e(){g.innerHTML=`
            <div class="playlist-loader" style="display:flex;align-items:center;gap:10px;">
                <svg width="32" height="32" viewBox="0 0 50 50" aria-hidden="true" focusable="false"><circle cx="25" cy="25" r="20" fill="none" stroke="#8008f0ff" stroke-width="5" stroke-linecap="round" stroke-dasharray="31.415, 31.415" transform="rotate(72.3242 25 25)"><animateTransform attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="1s" repeatCount="indefinite"/></circle></svg>
                <span id="playlist-loading-text">Laden van de Playlist...</span>
            </div>
        `}async function f(){e();try{const b=await d(h);if(g.innerHTML="",!Array.isArray(b)||0===b.length){const b=a("p","empty-message","Helaas, er zijn geen nummers gevonden.");return void g.appendChild(b)}const e=document.createDocumentFragment();b.forEach(a=>{e.appendChild(c(a))}),g.appendChild(e)}catch(b){const c=a("p","",`Fout bij het laden van de afspeellijst: ${b.message}`);g.innerHTML="",g.appendChild(c),console.error(b)}}const g=document.getElementById("playlist-container"),h="https://xr-api-prd.faststreamdiensten.nl/playlist",i="https://res.cloudinary.com/xerosradio/image/upload/f_webp,q_auto,w_200,h_200/XerosRadio_Logo_Achtergrond_Wit";(function(){let a=document.getElementById("playlist-refresh-btn");a||(a=document.createElement("button"),a.id="playlist-refresh-btn",a.type="button",a.className="playlist-refresh-btn",a.innerHTML="&#x21bb; Vernieuwen",a.title="Vernieuw de afspeellijst",a.style.margin="10px 0",a.onclick=()=>{a.disabled=!0,e(),f().finally(()=>{a.disabled=!1})},g.parentNode.insertBefore(a,g))})(),f()});