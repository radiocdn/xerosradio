const voteList=[],maxVotes=10,voteForm=document.getElementById("voteForm"),voteListEl=document.getElementById("voteList"),resultsEl=document.getElementById("results");let currentAudio=null,currentPlayIcon=null;const audioOverlay=document.getElementById("audioOverlay"),audioPreview=document.getElementById("audioPreview");let currentCoverWrapper=null,currentTrack=null;document.getElementById("searchBtn").addEventListener("click",()=>{const a=document.getElementById("searchInput").value;fetch(`https://xerosradiocdn.global.ssl.fastly.net/api/xerosradio/search/?q=${encodeURIComponent(a)}`).then(a=>a.json()).then(a=>{resultsEl.innerHTML="",a.results.forEach(a=>{const b=document.createElement("li"),c=document.createElement("img");c.src=a.cover_art200x200||"",c.alt="Cover";const d=document.createElement("div");d.className="cover-wrapper",d.appendChild(c),a.preview&&(audioOverlay.style.position="absolute",audioOverlay.style.width="",audioOverlay.style.height="",audioOverlay.style.top="",audioOverlay.style.left="",audioOverlay.style.right="",audioOverlay.style.bottom="",d.addEventListener("mouseenter",()=>{d.appendChild(audioOverlay),audioOverlay.style.display="block",audioOverlay.style.opacity="1",audioOverlay.innerHTML=audioPreview.paused||currentTrack!==a.preview?"<i class=\"fa-solid fa-play\"></i>":"<i class=\"fa-solid fa-pause\"></i>",currentCoverWrapper=d,currentTrack=a.preview,audioOverlay.onclick=()=>{audioPreview.src!==a.preview&&(audioPreview.src=a.preview),audioPreview.paused||currentTrack!==a.preview?(audioPreview.currentTime=0,audioPreview.play(),audioOverlay.innerHTML="<i class=\"fa-solid fa-pause\"></i>"):(audioPreview.pause(),audioOverlay.innerHTML="<i class=\"fa-solid fa-play\"></i>")}}),d.addEventListener("mouseleave",()=>{audioOverlay.style.display="none",audioOverlay.onclick=null})),b.appendChild(d);const e=document.createElement("div");e.className="track-info";const f=document.createElement("div");f.className="track-title",f.textContent=a.title;const g=document.createElement("div");g.className="track-artist",g.textContent=a.artist,e.appendChild(f),e.appendChild(g),b.appendChild(e);const h=document.createElement("button");h.type="button",h.textContent="Stem",h.onclick=()=>addVote({name:`${a.artist} - ${a.title}`,cover:a.cover_art200x200||""}),b.appendChild(h),resultsEl.appendChild(b)})})}),audioPreview.addEventListener("ended",()=>{audioOverlay.innerHTML="<i class=\"fa-solid fa-play\"></i>"}),audioPreview.addEventListener("pause",()=>{audioOverlay.innerHTML="<i class=\"fa-solid fa-play\"></i>"}),audioPreview.addEventListener("play",()=>{audioOverlay.innerHTML="<i class=\"fa-solid fa-pause\"></i>"});function addVote(a){return voteList.some(b=>b.name===a.name)?void 0:voteList.length>=maxVotes?void Swal.fire({title:"Maximaal aantal stemmen bereikt!",text:"Je kunt maximaal 10 stemmen uitbrengen.",confirmButtonText:"Sluiten",icon:"error"}):void(voteList.push(a),updateVoteList())}function updateVoteList(){voteListEl.innerHTML="",voteList.forEach((a,b)=>{const c=document.createElement("li");if(a.cover){const b=document.createElement("img");b.src=a.cover,b.alt="Cover",c.appendChild(b)}const d=document.createElement("div");d.className="track-info";const e=document.createElement("div");e.className="track-title",e.textContent=a.name,d.appendChild(e),c.appendChild(d);const f=document.createElement("button");f.textContent="Verwijder",f.type="button",f.style.background="linear-gradient(90deg, #008cff 70%, #8400ff 100%)",f.style.border="1.5px solid #008cff",f.style.color="white",f.style.borderRadius="6px",f.style.fontWeight="600",f.style.fontSize="0.9rem",f.style.padding="6px 12px",f.style.cursor="pointer",f.onmouseover=()=>f.style.background="linear-gradient(90deg, #008cff 70%, #8400ff 100%)",f.onmouseout=()=>f.style.background="linear-gradient(90deg, #008cff 70%, #8400ff 100%)",f.onclick=()=>{voteList.splice(b,1),updateVoteList()},c.appendChild(f),voteListEl.appendChild(c)})}voteForm.addEventListener("submit",async a=>{a.preventDefault();const b=document.getElementById("email").value;if(0===voteList.length)return void(document.getElementById("response").textContent="Je moet minimaal 1 nummer kiezen om te stemmen.");const c=voteList.map(a=>a.name);try{const a=await fetch("https://xerosradiocdn.global.ssl.fastly.net/api/xerosradio/vote/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:b,votes:c})}),d=await a.json();document.getElementById("response").textContent=d.message,d.success&&(voteList.length=0,updateVoteList())}catch(a){document.getElementById("response").textContent="Er is een fout opgetreden tijdens het verzenden."}});