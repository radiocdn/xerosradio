const video=document.getElementById("xerosPlayer"),poster=document.getElementById("posterOverlay"),playOverlay=document.getElementById("playOverlay"),playIconOverlay=playOverlay.querySelector("i"),btnPlayPause=document.getElementById("btnPlayPause"),btnMute=document.getElementById("btnMute"),volumeRange=document.getElementById("volumeRange"),btnFullscreen=document.getElementById("btnFullscreen"),djName=document.getElementById("djName"),djCover=document.getElementById("djCover"),videoWrapper=document.getElementById("videoWrapper"),customControls=document.getElementById("customControls"),djInfo=document.getElementById("djInfo"),customMenu=document.getElementById("customContextMenu");let hls,currentStreamUrl="",currentPoster="";async function fetchStreamInfo(){try{const a=await fetch("https://xr-tv.faststreamdiensten.nl/api/"),b=await a.json();if(b.streams&&0<b.streams.length){const a=b.streams.find(a=>"XerosRadio"===a.name);if(!a)return void console.warn("XerosRadio stream not found");currentStreamUrl=a.playlist,currentPoster=a.still,poster.src=currentPoster}}catch(a){console.error("Kan stream info niet ophalen:",a)}}function togglePlay(){currentStreamUrl&&(video.paused?(hls?(video.play(),poster.style.opacity=0):Hls.isSupported()?(hls=new Hls,hls.loadSource(currentStreamUrl),hls.attachMedia(video),hls.on(Hls.Events.MANIFEST_PARSED,()=>{video.play(),poster.style.opacity=0})):video.canPlayType("application/vnd.apple.mpegurl")&&(video.src=currentStreamUrl,video.addEventListener("loadedmetadata",()=>{video.play(),poster.style.opacity=0})),playOverlay.classList.add("hide"),playIconOverlay.className="fas fa-pause",btnPlayPause.className="fas fa-pause"):(video.pause(),playOverlay.classList.remove("hide"),playIconOverlay.className="fas fa-play",btnPlayPause.className="fas fa-play",poster.style.opacity=1))}playOverlay.addEventListener("click",togglePlay),btnPlayPause.addEventListener("click",togglePlay),video.addEventListener("click",togglePlay),btnMute.addEventListener("click",()=>{video.muted=!video.muted,btnMute.className=video.muted?"fas fa-volume-mute":"fas fa-volume-up",volumeRange.value=video.muted?0:video.volume}),volumeRange.addEventListener("input",()=>{video.volume=volumeRange.value,video.muted=0===video.volume,btnMute.className=video.muted?"fas fa-volume-mute":"fas fa-volume-up"}),btnFullscreen.addEventListener("click",()=>{document.fullscreenElement?(document.exitFullscreen(),btnFullscreen.className="fas fa-expand"):(videoWrapper.requestFullscreen(),btnFullscreen.className="fas fa-compress")});let hideTimeout;function resetHideTimer(){clearTimeout(hideTimeout),customControls.classList.remove("hide"),djInfo.classList.remove("hide"),videoWrapper.classList.remove("hide-cursor"),hideTimeout=setTimeout(()=>{customControls.classList.add("hide"),djInfo.classList.add("hide"),videoWrapper.classList.add("hide-cursor")},3e3)}videoWrapper.addEventListener("mousemove",resetHideTimer),videoWrapper.addEventListener("mouseleave",resetHideTimer);async function fetchDJInfo(){try{const a=await fetch("https://xr-api-prd.faststreamdiensten.nl"),b=await a.json();b.onair_info&&(djName.textContent=b.onair_info.dj_name,djCover.src=b.onair_info.dj_cover,"mediaSession"in navigator&&(navigator.mediaSession.metadata=new MediaMetadata({title:"Live TV",artist:b.onair_info.dj_name,artwork:[{src:b.onair_info.dj_cover,sizes:"128x128",type:"image/webp"},{src:b.onair_info.dj_cover,sizes:"256x256",type:"image/webp"},{src:b.onair_info.dj_cover,sizes:"512x512",type:"image/webp"}]})))}catch(a){console.error("Kan DJ info niet ophalen:",a)}}fetchDJInfo(),setInterval(fetchDJInfo,3e4),"mediaSession"in navigator&&(navigator.mediaSession.setActionHandler("play",togglePlay),navigator.mediaSession.setActionHandler("pause",togglePlay)),document.addEventListener("keydown",a=>{"Space"===a.code&&(a.preventDefault(),togglePlay())}),videoWrapper.addEventListener("contextmenu",a=>{a.preventDefault();const b=videoWrapper.getBoundingClientRect();customMenu.style.left=`${a.clientX-b.left}px`,customMenu.style.top=`${a.clientY-b.top}px`,customMenu.classList.add("show")}),document.addEventListener("click",()=>{customMenu.classList.remove("show")}),resetHideTimer(),fetchStreamInfo();